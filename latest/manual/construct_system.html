<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Construct body-joint system · Dyn3d.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/><link href="../assets/custom.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>Dyn3d.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search.html"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../index.html">Home</a></li><li><span class="toctext">Manual</span><ul><li class="current"><a class="toctext" href="construct_system.html">Construct body-joint system</a><ul class="internal"><li><a class="toctext" href="#User-oriented-set-up-1">User-oriented set up</a></li><li><a class="toctext" href="#Code-oriented-construction-1">Code-oriented construction</a></li><li><a class="toctext" href="#Methods-1">Methods</a></li><li><a class="toctext" href="#Index-1">Index</a></li></ul></li><li><a class="toctext" href="fluid_interaction.html">Fluid-Structure Interaction</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>Manual</li><li><a href="construct_system.html">Construct body-joint system</a></li></ul><a class="edit-page" href="https://github.com/ruizhi92/Dyn3d.jl/blob/master/docs/src/manual/construct_system.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Construct body-joint system</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Construct-body-joint-system-1" href="#Construct-body-joint-system-1">Construct body-joint system</a></h1><p>Constructing the body-joint system requires filling in a lot of detailed information, like body-joint hierarchy information, body inertia, joint degree of freedoms type etc. In this section we introduce the construction of the system in two aspects:</p><ul><li><p>User-oriented set up(front end)</p></li><li><p>Code-oriented construction(back end)</p></li></ul><h2><a class="nav-anchor" id="User-oriented-set-up-1" href="#User-oriented-set-up-1">User-oriented set up</a></h2><p>To set up a body-joint system, one needs to know how to set body properties and joint properties, also the hierarchy information. In this section we introduce how to set up the body-joint system, together with other information needed to enclosure the problem we&#39;re interested in.</p><p>The set up of the problem generally has 3 parts: set up body, set up joint, and set up system information like the dimension of this problem, gravity, numerical parameters etc. We will use these information provided by the user to construct every single body, every single joint, and finally connect them with hierarchy information. Some examples of providing user-set-up information are listed in <code>src/config_files</code> for user convenience. Here we take the <code>2dFall.jl</code> as an example to show the procedure of setting up the problem.</p><p><code>ConfigDataType</code></p><h2><a class="nav-anchor" id="Code-oriented-construction-1" href="#Code-oriented-construction-1">Code-oriented construction</a></h2><p>Before running any dynamics, we need to construct the body-joint system, connecting bodies by joints in the correct hierarchy using supplied configuration information. In order to do that, three key functions are used:</p><ul><li><p><a href="construct_system.html#Dyn3d.ConstructSystem.AddBody-Tuple{Int64,Dyn3d.ConfigDataType.ConfigBody}"><code>AddBody</code></a></p></li><li><p><a href="construct_system.html#Dyn3d.ConstructSystem.AddJoint-Tuple{Int64,Dyn3d.ConfigDataType.ConfigJoint}"><code>AddJoint</code></a></p></li><li><p><a href="construct_system.html#Dyn3d.ConstructSystem.AssembleSystem-Tuple{Array{Dyn3d.ConstructSystem.SingleBody,1},Array{Dyn3d.ConstructSystem.SingleJoint,1},Dyn3d.ConstructSystem.System}"><code>AssembleSystem</code></a></p></li></ul><p>which is responsible for add a body to the body system, add a joint to the joint system and assemble the body-joint system and fill in extra hierarchy information. These three functions are also bundled in the correct sequential order in</p><ul><li><p><a href="construct_system.html#Dyn3d.ConstructSystem.BuildChain-Tuple{Array{Dyn3d.ConfigDataType.ConfigBody,1},Array{Dyn3d.ConfigDataType.ConfigJoint,1},Dyn3d.ConfigDataType.ConfigSystem}"><code>BuildChain(cbs, cjs, csys)</code></a></p></li></ul><p>In order to solve for the rigid body-joint chain system, we choose body velocity <span>$v$</span> and joint displacement <span>$qJ$</span> as main variables in the time marching scheme. We also need to construct a structure that stores and updates the body-joint chain&#39;s intermediate variables such as all kinds of transformation matrices <span>$X$</span>, body position in the inertial space <span>$x_i$</span> and so on. All information of the body-joint system is bundled into a <code>BodyDyn</code> structure.</p><h2><a class="nav-anchor" id="Methods-1" href="#Methods-1">Methods</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Dyn3d.ConfigDataType.ConfigBody" href="#Dyn3d.ConfigDataType.ConfigBody"><code>Dyn3d.ConfigDataType.ConfigBody</code></a> — <span class="docstring-category">Type</span>.</div><div><pre><code class="language-none">ConfigBody(nbody::Int,nverts::Int,verts::Matrix{Float64},ρ::Float64)</code></pre><p>Set up configuration information for the a single body in the body system. Here we assume that all bodies has the same shape if more than one body exists. A single body is an infinitely thin body in y direction. It must have polygon shape and is described in z-x space. For example if we describe a rectangle in z-x space, for 3d problem it&#39;s just fine. For 2d problem in x-y space, this rectangle has a projection  of a line in x-y space. The vertices local coordinates are described in clockwise direction as a convention.</p><p><strong>Fields</strong></p><ul><li><p><code>nbody</code>: Number of bodies in total</p></li><li><p><code>nverts</code>: Number of vertices for one body</p></li><li><p><code>verts</code>: Polygon vertices coordinates starting from the left bottom vert and   going in clockwise direction. Each line describes the (z,x) coordinate of   this vertice. Usually the z-dimesion has unit length 1 for 2-d problem.</p></li><li><p><code>ρ</code>: Density of this body in mass per area</p></li></ul><p><strong>Body setup</strong></p><pre><code class="language-none">     ^(y)
     |
     |-----&gt;(x)
    /
 (-z)</code></pre></div><a class="source-link" target="_blank" href="https://github.com/ruizhi92/Dyn3d.jl/blob/1ac0d79f1a89282ec4955035a22856d77f55471a/src/config_files/ConfigDataType.jl#L117-L143">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Dyn3d.ConfigDataType.ConfigJoint" href="#Dyn3d.ConfigDataType.ConfigJoint"><code>Dyn3d.ConfigDataType.ConfigJoint</code></a> — <span class="docstring-category">Type</span>.</div><div><pre><code class="language-none">ConfigJoint(njoint,joint_type,shape1,shape2,body1,joint_dof,qJ_init)</code></pre><p>Set up configuration information for a single joint. A joint allows one/multiple degree of freedoms from 1 to 6.</p><p><strong>Fields</strong></p><ul><li><p><code>njoint</code>: Int, total number of joints for this body-joint system</p></li><li><p><code>joint_type</code>: String, allows &quot;revolute&quot;, &quot;prismatic&quot;, &quot;cylindrical&quot;, &quot;planar&quot;,   &quot;spherical&quot;, &quot;free&quot; and &quot;custom&quot;. Detailed information is described in <code>JointType</code>   section</p></li><li><p><code>shape1</code>: Vector{Float64} with 6 elements. It describes the location of this   joint in its parent body coordinate. If shape1 is used on the first joint,   then it&#39;s the orientation of this first joint to inertial system. It is written   with [θx, θy, θz, x, y, z].</p></li><li><p><code>shape2</code>: Vector{Float64} with 6 elements. It describes the location of this   joint in its child body coordinate. Normally, shape2 is zeros(Float64,6) if   there&#39;s no distance gap or angle gap between two adjacent bodies.</p></li><li><p><code>body1</code>: the parent body id of this joint</p></li><li><p><code>joint_dof</code>: Vector{Float64}. The size of joint_dof depends on the number of   specified dof, refers to type <code>Dof</code>.</p></li><li><p><code>qJ_init</code>: Vector{Float64}. It is the initial angle/displacement of this joint   with respect to its parent body. The size should be the same as the number of   dof specified.</p></li></ul></div><a class="source-link" target="_blank" href="https://github.com/ruizhi92/Dyn3d.jl/blob/1ac0d79f1a89282ec4955035a22856d77f55471a/src/config_files/ConfigDataType.jl#L162-L187">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Dyn3d.ConfigDataType.ConfigSystem" href="#Dyn3d.ConfigDataType.ConfigSystem"><code>Dyn3d.ConfigDataType.ConfigSystem</code></a> — <span class="docstring-category">Type</span>.</div><div><pre><code class="language-none">ConfigSystem(ndim::Int,gravity::Vector{Float64},num_params::NumParams)</code></pre><p>Additional system information to define this problem.</p><p><strong>Fields</strong></p><ul><li><p><code>ndim</code>: Dimension of this problem. Choices are 2 or 3</p></li><li><p><code>gravity</code>: Non-dimensional gravity. It is in [x,y,z] direction. So if we&#39;re   describing a 2d problem with gravity pointing downward, it should be [0.,-1.,0.]</p></li><li><p><code>num_params</code>: Refer to type <code>NumParams</code></p></li></ul></div><a class="source-link" target="_blank" href="https://github.com/ruizhi92/Dyn3d.jl/blob/1ac0d79f1a89282ec4955035a22856d77f55471a/src/config_files/ConfigDataType.jl#L244-L254">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Dyn3d.ConfigDataType.Dof" href="#Dyn3d.ConfigDataType.Dof"><code>Dyn3d.ConfigDataType.Dof</code></a> — <span class="docstring-category">Type</span>.</div><div><pre><code class="language-none">Dof(dof_id::Int,dof_type::String,stiff::Float64,damp::Float64,motion::Motions)</code></pre><p>Set up a single degree of freedom(dof) information in a joint. A joint may have a maximum 6 dofs and minimum 1 dof(either active or passive). Here we don&#39;t allow it to have 0 since there&#39;s no reason to do this. If we want the parent body and child body to have no relative motion(i.e. they&#39;re rigidly connected together), we can set the second joint has only one dof and this dof has active &quot;hold&quot; motion.</p><p><strong>Fields</strong></p><ul><li><p><code>dof_id</code>: Choose from 1 to 6 and is corresponding to [Ox, Oy, Oz, x, y, z].</p></li><li><p><code>dof_type</code>: &quot;passive&quot; or &quot;active&quot;</p></li><li><p><code>stiff</code>: Non-dimensional stiffness of a string associated with this degree of   freedom. Only has effect on solving the system when this dof is passive.</p></li><li><p><code>damp</code>: Similar to stiff, this assigns the damping coefficient of this dof.</p></li><li><p><code>motion</code>: Defines the motion of this dof. Refer to type <code>Motion</code></p></li></ul></div><a class="source-link" target="_blank" href="https://github.com/ruizhi92/Dyn3d.jl/blob/1ac0d79f1a89282ec4955035a22856d77f55471a/src/config_files/ConfigDataType.jl#L90-L106">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Dyn3d.ConfigDataType.Motions" href="#Dyn3d.ConfigDataType.Motions"><code>Dyn3d.ConfigDataType.Motions</code></a> — <span class="docstring-category">Type</span>.</div><div><pre><code class="language-none">Motions(type::String, parameters::Vector{Float64})</code></pre><p>A structure representing active motion of a joint, allowing different types of motion, can be time-dependent.</p><p><strong>Fields</strong></p><ul><li><p><code>motion_type</code>: Allow choices of &quot;hold&quot;, &quot;velocity&quot;, &quot;oscillatory&quot;, &quot;ramp_1&quot;, &quot;ramp_2&quot;</p></li><li><p><code>motion_params</code>: Numerical parameters provided to describe the motion</p></li></ul><p><strong>Constructors</strong></p><ul><li><p><code>Motions(): Provide no active motion</code></p></li><li><p><code>Motions(&quot;hold&quot;, [qJ])</code>: Hold the joint at constant qJ and vJ=0</p></li><li><p><code>Motions(&quot;velocity&quot;,[qJ,vJ])</code>: Specify constant vJ of this joint with initial angle qJ</p></li><li><p><code>Motions(&quot;oscillatory&quot;,[amp,freq,phase])</code> specify a oscillatory motion through   <span>$qJ = amp*cos(2π*freq*t+phase)$</span></p></li><li><p><code>Motions(&quot;ramp_1&quot;,[a,t₁,t₂,t₃,t₄])</code>: Describes a ramp motion in <a href="#footnote-1">[1]</a></p></li><li><p><code>Motions(&quot;ramp_2&quot;,[a])</code>: Describes a decelerating motion with an initial velocity</p></li></ul><div class="footnote" id="footnote-1"><a href="#footnote-1"><strong>[1]</strong></a><p>Eldredge, Jeff, Chengjie Wang, and Michael Ol. &quot;A computational study of a canonical pitch-up,</p></div><p>pitch-down wing maneuver.&quot; In 39th AIAA fluid dynamics conference, p. 3687. 2009.</p><p><strong>Functions</strong></p><ul><li><p><code>(m::Motions)(t)</code>: Evalutes the motion type at time t, return joint angle qJ and   velocity vJ</p></li></ul></div><a class="source-link" target="_blank" href="https://github.com/ruizhi92/Dyn3d.jl/blob/1ac0d79f1a89282ec4955035a22856d77f55471a/src/config_files/ConfigDataType.jl#L8-L34">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Dyn3d.ConfigDataType.NumParams" href="#Dyn3d.ConfigDataType.NumParams"><code>Dyn3d.ConfigDataType.NumParams</code></a> — <span class="docstring-category">Type</span>.</div><div><pre><code class="language-none">NumParams(tf::Float64,dt::Float64,scheme::String,st::Int,tol::Float64)</code></pre><p>Numerical parameters needed for the time marching scheme.</p><p><strong>Fields</strong></p><ul><li><p><code>tf</code>: The end time of this run</p></li><li><p><code>dt</code>: Time step size</p></li><li><p><code>scheme</code>: Applies the implicit Runge-kutta method of different coefficient, choices   are &quot;Liska&quot;(2nd order), &quot;BH3&quot;(3rd order), &quot;BH5&quot;(4th order), &quot;Euler&quot;(1st order),   &quot;RK2&quot;(2nd order), &quot;RK22&quot;(2nd order).</p></li><li><p><code>st</code>: The number of stages of this RK scheme</p></li><li><p><code>tol</code>: Tolerance used in time marching for adptive time step</p></li></ul></div><a class="source-link" target="_blank" href="https://github.com/ruizhi92/Dyn3d.jl/blob/1ac0d79f1a89282ec4955035a22856d77f55471a/src/config_files/ConfigDataType.jl#L220-L234">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Dyn3d.ConstructSystem.Soln" href="#Dyn3d.ConstructSystem.Soln"><code>Dyn3d.ConstructSystem.Soln</code></a> — <span class="docstring-category">Type</span>.</div><div><p>This module construct the body-joint system by:     1. AddBody     2. AddJoint     3. AssembleSystem</p></div><a class="source-link" target="_blank" href="https://github.com/ruizhi92/Dyn3d.jl/blob/1ac0d79f1a89282ec4955035a22856d77f55471a/src/ConstructSystem.jl#L16-L21">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Dyn3d.ConstructSystem.AddBody-Tuple{Int64,Dyn3d.ConfigDataType.ConfigBody}" href="#Dyn3d.ConstructSystem.AddBody-Tuple{Int64,Dyn3d.ConfigDataType.ConfigBody}"><code>Dyn3d.ConstructSystem.AddBody</code></a> — <span class="docstring-category">Method</span>.</div><div><pre><code class="language-none">AddBody(id::Int, cf::ConfigBody)</code></pre><p>Using ConfigBody information, add one body to the body system bs</p></div><a class="source-link" target="_blank" href="https://github.com/ruizhi92/Dyn3d.jl/blob/1ac0d79f1a89282ec4955035a22856d77f55471a/src/ConstructSystem.jl#L326-L330">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Dyn3d.ConstructSystem.AddJoint-Tuple{Int64,Dyn3d.ConfigDataType.ConfigJoint}" href="#Dyn3d.ConstructSystem.AddJoint-Tuple{Int64,Dyn3d.ConfigDataType.ConfigJoint}"><code>Dyn3d.ConstructSystem.AddJoint</code></a> — <span class="docstring-category">Method</span>.</div><div><pre><code class="language-none">AddJoint(id::Int, cf::ConfigJoint)</code></pre><p>Using ConfigJoint information, add one joint to the joint system js</p></div><a class="source-link" target="_blank" href="https://github.com/ruizhi92/Dyn3d.jl/blob/1ac0d79f1a89282ec4955035a22856d77f55471a/src/ConstructSystem.jl#L409-L413">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Dyn3d.ConstructSystem.AssembleSystem-Tuple{Array{Dyn3d.ConstructSystem.SingleBody,1},Array{Dyn3d.ConstructSystem.SingleJoint,1},Dyn3d.ConstructSystem.System}" href="#Dyn3d.ConstructSystem.AssembleSystem-Tuple{Array{Dyn3d.ConstructSystem.SingleBody,1},Array{Dyn3d.ConstructSystem.SingleJoint,1},Dyn3d.ConstructSystem.System}"><code>Dyn3d.ConstructSystem.AssembleSystem</code></a> — <span class="docstring-category">Method</span>.</div><div><pre><code class="language-none">AssembleSystem(bs::Vector{SingleBody}, js::Vector{SingleJoint}, sys::System)</code></pre><p>With body system bs and joint system js, fill in extra hierarchy information about the whole system, connects bodies and joints.</p></div><a class="source-link" target="_blank" href="https://github.com/ruizhi92/Dyn3d.jl/blob/1ac0d79f1a89282ec4955035a22856d77f55471a/src/ConstructSystem.jl#L517-L522">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Dyn3d.ConstructSystem.BuildChain-Tuple{Array{Dyn3d.ConfigDataType.ConfigBody,1},Array{Dyn3d.ConfigDataType.ConfigJoint,1},Dyn3d.ConfigDataType.ConfigSystem}" href="#Dyn3d.ConstructSystem.BuildChain-Tuple{Array{Dyn3d.ConfigDataType.ConfigBody,1},Array{Dyn3d.ConfigDataType.ConfigJoint,1},Dyn3d.ConfigDataType.ConfigSystem}"><code>Dyn3d.ConstructSystem.BuildChain</code></a> — <span class="docstring-category">Method</span>.</div><div><pre><code class="language-none">BuildChain(cbs::Vector{ConfigBody}, cjs::Vector{ConfigJoint}, csys::ConfigSystem)</code></pre><p>Put AddBody, AddJoint and AssembleSystem in sequential order in a single function</p></div><a class="source-link" target="_blank" href="https://github.com/ruizhi92/Dyn3d.jl/blob/1ac0d79f1a89282ec4955035a22856d77f55471a/src/ConstructSystem.jl#L692-L696">source</a></section><h2><a class="nav-anchor" id="Index-1" href="#Index-1">Index</a></h2><ul><li><a href="construct_system.html#Dyn3d.ConfigDataType.ConfigBody"><code>Dyn3d.ConfigDataType.ConfigBody</code></a></li><li><a href="construct_system.html#Dyn3d.ConfigDataType.ConfigJoint"><code>Dyn3d.ConfigDataType.ConfigJoint</code></a></li><li><a href="construct_system.html#Dyn3d.ConfigDataType.ConfigSystem"><code>Dyn3d.ConfigDataType.ConfigSystem</code></a></li><li><a href="construct_system.html#Dyn3d.ConfigDataType.Dof"><code>Dyn3d.ConfigDataType.Dof</code></a></li><li><a href="construct_system.html#Dyn3d.ConfigDataType.Motions"><code>Dyn3d.ConfigDataType.Motions</code></a></li><li><a href="construct_system.html#Dyn3d.ConfigDataType.NumParams"><code>Dyn3d.ConfigDataType.NumParams</code></a></li><li><a href="construct_system.html#Dyn3d.ConstructSystem.Soln"><code>Dyn3d.ConstructSystem.Soln</code></a></li><li><a href="construct_system.html#Dyn3d.ConstructSystem.AddBody-Tuple{Int64,Dyn3d.ConfigDataType.ConfigBody}"><code>Dyn3d.ConstructSystem.AddBody</code></a></li><li><a href="construct_system.html#Dyn3d.ConstructSystem.AddJoint-Tuple{Int64,Dyn3d.ConfigDataType.ConfigJoint}"><code>Dyn3d.ConstructSystem.AddJoint</code></a></li><li><a href="construct_system.html#Dyn3d.ConstructSystem.AssembleSystem-Tuple{Array{Dyn3d.ConstructSystem.SingleBody,1},Array{Dyn3d.ConstructSystem.SingleJoint,1},Dyn3d.ConstructSystem.System}"><code>Dyn3d.ConstructSystem.AssembleSystem</code></a></li><li><a href="construct_system.html#Dyn3d.ConstructSystem.BuildChain-Tuple{Array{Dyn3d.ConfigDataType.ConfigBody,1},Array{Dyn3d.ConfigDataType.ConfigJoint,1},Dyn3d.ConfigDataType.ConfigSystem}"><code>Dyn3d.ConstructSystem.BuildChain</code></a></li></ul><footer><hr/><a class="previous" href="../index.html"><span class="direction">Previous</span><span class="title">Home</span></a><a class="next" href="fluid_interaction.html"><span class="direction">Next</span><span class="title">Fluid-Structure Interaction</span></a></footer></article></body></html>
